<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
  <link href="https://unpkg.com/nes.css@2.2.1/css/nes.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">
  <style media="screen">
  @import url('https://fonts.googleapis.com/css?family=Press+Start+2P&display=swap');
  .card{
    float: left;
    width: 23%;
    margin: 1%;
    height: 30vh;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    transition: 0.3s all ease-out;
  }
  .card:hover{
    transform: scale(0.96);
  }
  .cover{
    background-image: url('https://cdn1.iconfinder.com/data/icons/graphorama-playing-cards-3/80/back-512.png');
  }
  #gameContainer{
    float: left;
    width: 80%;
  }
  #display{
    font-family: 'Press Start 2P', cursive;
    float: left;
    width: 20%;
    color: white;
  }

  </style>
</head>
<body id="body">

  <div id="display">
    <br>
    <div class="nes-container is-dark with-title">
  <p class="title">MEMO-TEST</p>

    CLICKS: <span id="clicks_container">0</span><br><br>
    SCORE: <span id="score_container">0</span><br><br>
    LEVEL: <span id="level_container">1</span><br><br>
    HIGH-SCORE: <span id="high_container">1</span><br><br>
    TIME: <span id="time_container">1</span><br><br>
  </div>
  </div>

  <div id="success_container" class="">
    <div class="before"></div>
    <div class="after"></div>
  </div>

    <!-- <p>Good morning. Thou hast had a good night's sleep, I hope.</p> -->
    <div id="gameContainer"></div>



  <script type="text/javascript">
  //variables globales
  var game_container = document.getElementById('gameContainer');
  var card_one, card_two;
  var turn = true;
  var lock_board = false;
  var clicks = 0;
  var score = 0;
  var shuffledCards=[];
  var cards=[
    'http://chetart.com/blog/wp-content/uploads/2016/04/cropped-cropped-siteicon.jpg',
    'http://chetart.com/blog/wp-content/uploads/2019/09/BigWheelPinCarded640.png',
    'http://chetart.com/blog/wp-content/uploads/2019/09/TotoroPedalPinCarded640.png',
    'http://chetart.com/blog/wp-content/uploads/2019/05/SkellingtonShadowbox1Blog.png',
    'https://media.giphy.com/media/WrVOtWEay7fJS/giphy.gif',
    'https://media1.tenor.com/images/6135aa955cf464d4b8f538310c1268fe/tenor.gif?itemid=5722800'
  ];
  var matched=cardQty=1;
  var seconds=0;
  var startTimer;
  var sound = document.createElement("audio");
  sound.src = 'alert.mp3';

  function duplicateArray(qty) {//duplicamos las cartas en el array
    b=[];
    for(var i = 0; i< qty;++i){
      b.push(cards[i]);
      b.push(cards[i]);
    }
    shuffledCards = b;
  }

  if (localStorage.getItem('high-score')) {
    document.getElementById('high_container').innerHTML=JSON.parse(localStorage.getItem('high-score')).highScore + " USER: " + JSON.parse(localStorage.getItem('high-score')).username;
  }
  //funcion para crear el tablero
  function createBoard() {
    shuffledCards.sort(function() {//mezclamos las cartas...este metodo no es muy random,,,pero bueh
      return .5 - Math.random();
    });
    shuffledCards.forEach(function(elemento) {
      var div = document.createElement('div');
      div.dataset.imgCard = elemento;
      div.classList.add('card', 'cover');
      game_container.appendChild(div);
    });
  }

  //Escuchamos los click en nuestro tablero
  game_container.onclick=function(event){
    if(event.target==game_container || event.target.classList.contains('disabled') || lock_board)return;
    clicks++;
    if (clicks==1) {
       startTimer = setInterval(timerFun, 1000);
    }
    document.getElementById('clicks_container').innerHTML=clicks;
    toggleCard(event.target);
    if (!turn) {
      checkIfMatch();
    }
    turn = !turn;
  };

  function timerFun() {
    seconds++;
    document.getElementById('time_container').innerHTML=seconds;
  }

  function toggleCard(elementoHTML) {
    if (turn) {
      card_one=elementoHTML;
      card_one.style.backgroundImage="url("+card_one.dataset.imgCard+")";
    }else {
      card_two=elementoHTML;
      card_two.style.backgroundImage="url("+card_two.dataset.imgCard+")";
    }
    card_one.classList.toggle('disabled');//explicacion,,,,,rara
  }


  function disableCards() {
    card_one.classList.add('disabled');
    card_two.classList.add('disabled');
  }


  function resetCards() {
    card_one.style.backgroundImage='';
    card_two.style.backgroundImage='';
    card_one.classList.add('cover');
    card_two.classList.add('cover');
  }

  function checkIfMatch() {
    score=score-seconds*2;
    if (card_one.dataset.imgCard == card_two.dataset.imgCard) {
      score+=1800;
      matched--;
      sound.pause();
      sound.currentTime = 0;
      sound.play();
      document.getElementById('score_container').innerHTML=score;
      disableCards();
      document.getElementById('success_container').classList.add('pyro');
      setTimeout(function(){
        if (matched==0) {
          levelUp();
        }
        document.getElementById('success_container').classList.remove('pyro');
      }, 3000);
    }else {
      score-=800;
      document.getElementById('score_container').innerHTML=score;
      lock_board = true;//no queremos que hagan click mientras se dan vuelta las tarjetas
      document.getElementById('body').classList.add('wrong');
      card_one.classList.add("alert");
      card_two.classList.add("alert");
      setTimeout(function(){
        lock_board = false;
        resetCards();
        document.getElementById('body').classList.remove('wrong');
        card_one.classList.remove("alert");
        card_two.classList.remove("alert");
      }, 700);
    }
  }

  function levelUp() {

    if (cardQty==cards.length) {
      if (score>JSON.parse(localStorage.getItem('high-score')).highScore) {
        var userName = prompt('Ingrese su nombre');
        localStorage.setItem('high-score', JSON.stringify({
          username: userName,
          highScore: score
        }));
        document.getElementById('high_container').innerHTML=score + " USER: " + userName;
      }
      clearInterval(startTimer);
    }
    matched=cardQty+=1;
    if (matched<=cards.length) {
      document.getElementById('level_container').innerHTML=matched;
      game_container.innerHTML='';
      duplicateArray(cardQty);
      createBoard();
    }else {
      return;
    }
  }
  //flow
  //duplicamos las imagenes
  duplicateArray(cardQty);
  //ejecutamos la funcion de crear tablero
  createBoard();
  </script>


</body>
</html>
